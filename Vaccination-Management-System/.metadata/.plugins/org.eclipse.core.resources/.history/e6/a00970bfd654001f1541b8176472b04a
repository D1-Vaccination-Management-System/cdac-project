package com.app.service;

import java.util.Optional;

import org.modelmapper.ModelMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.app.dto.AdminDTO;
import com.app.entities.Admin;
import com.app.entities.VaccinationCenter;
import com.app.repo.IAdminRepo;
import com.app.repo.IVaccinationCenterRepo;

@Service
public class AdminService implements IAdminService {

	@Autowired
	private IAdminRepo adminRepo;

	@Autowired
	private IVaccinationCenterRepo centerRepo;

	@Autowired
	private ModelMapper mapper;

	@Override
	public Admin addAdminToCenter(Long centerId, AdminDTO adminDTO) {
		// Retrieve the VaccinationCenter by centerId
		Optional<VaccinationCenter> optionalCenter = centerRepo.findById(centerId);
		if (!optionalCenter.isPresent()) {
			throw new RuntimeException("Vaccination Center not found with id: " + centerId);
		}

		VaccinationCenter center = optionalCenter.get();
		Admin admin = mapper.map(adminDTO, Admin.class);

		admin.setVaccinationCenter(center); // Assuming a setCenter method exists in Admin

		Admin savedAdmin = adminRepo.save(admin);

		center.setAdmin(savedAdmin); // Set the admin for the center
		centerRepo.save(center);

		return savedAdmin;
	}

}
